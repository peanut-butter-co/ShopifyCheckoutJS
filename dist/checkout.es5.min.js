"use strict";function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(i,r.prototype),i}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var NotValidFieldException=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);var i="".concat(e," does not have a valid Shopify field element as parent.");return(n=t.call(this,i)).name="NotValidFieldException",n}return _createClass(r)}(),NotImplementedError=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e){_classCallCheck(this,r);var n=(new Error).stack.split("\n")[2].replace(" at ",""),i="The method ".concat(n," isn't implemented.");return e&&(i+=' Message: "'.concat(e,'".')),t.call(this,i)}return _createClass(r)}(),SelectionMethod=function(e){_inherits(t,_wrapNativeSuper(HTMLDivElement));_createSuper(t);function t(e){if(_classCallCheck(this,t),!(e instanceof HTMLDivElement&&e.classList.contains("radio-wrapper")))throw TypeError("Not a radio-wrapper");return Object.setPrototypeOf(e,t.prototype),_possibleConstructorReturn(void 0,Object.assign(e,{type:"generic"}))}return _createClass(t,[{key:"addDescription",value:function(e){throw new NotImplementedError}},{key:"input",get:function(){var e=this.querySelector("input");return e||Error("No input found for the ".concat(this.type," method"))}},{key:"methodData",get:function(){return this.input.dataset}},{key:"methodId",get:function(){return this.input.id}},{key:"checked",get:function(){return this.input.checked},set:function(e){this.input.checked=e}}]),t}(),ShippingMethod=function(e){_inherits(r,SelectionMethod);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),n.type="shipping",n.addEventListener("change",(function(){var e=new CustomEvent("checkout:shippingmethod:changed",{detail:_assertThisInitialized(n)});document.dispatchEvent(e)})),n}return _createClass(r,[{key:"addDescription",value:function(e){var t=this.querySelector(".radio__label__primary"),r=document.createElement("span");r.classList.add("small-text"),r.innerHTML=e,t.appendChild(document.createElement("br")),t.appendChild(r)}},{key:"shippingRate",get:function(){return this.methodData.checkoutTotalShippingCents/100}},{key:"subtotalPrice",get:function(){return this.methodData.checkoutSubtotalPriceCents/100}}]),r}(),PaymentMethod=function(e){_inherits(r,SelectionMethod);var t=_createSuper(r);function r(e){var n;if(_classCallCheck(this,r),!e.dataset.selectGateway)throw new NotValidFieldException;return n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),n.type="payment",n.addEventListener("change",(function(){var e=new CustomEvent("checkout:paymentmethod:changed",{detail:_assertThisInitialized(n)});document.dispatchEvent(e)})),n}return _createClass(r,[{key:"addDescription",value:function(e){this.nextElementSibling.querySelector(".blank-slate").innerHTML=e}},{key:"methodData",get:function(){return this.dataset}},{key:"gatewayId",get:function(){return this.dataset.selectGateway}},{key:"gatewayName",get:function(){return this.dataset.gatewayName}}]),r}(),FieldRetriever=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"retrieve",value:function(e){var t=null;if([".field",".checkbox-wrapper"].some((function(r){if(null!=(t=e.closest(r)))return!0}))){var r={};if(t.classList.contains("field"))r=t;else{r=document.createElement("div");var n=t.parentElement;r.classList.add("field"),r.appendChild(t),n.appendChild(r)}return this._setFieldPropierties(r),r}throw new NotValidFieldException}},{key:"_setFieldPropierties",value:function(e){e.children&&(e.wrapperClass=e.children[0].classList[0])}}]),e}(),Field=function(e){_inherits(t,_wrapNativeSuper(HTMLDivElement));_createSuper(t);function t(e){_classCallCheck(this,t);var r={input:'[id^="checkout_"]',errorMessage:".field__message--error",wrapper:".field__input-wrapper"},n={wrapper:["field__input-wrapper"],field:["field"],fieldInput:["field__input"],label:["field__label","field__label--visible"],fieldError:["field--error"],fieldErrorMessage:["field__message","field__message--error"]};if("string"==typeof e){var i=document.querySelector("#".concat(e)),o=(new FieldRetriever).retrieve(i);return Object.setPrototypeOf(o,t.prototype),_possibleConstructorReturn(void 0,Object.assign(o,{fieldName:o.name,fieldId:o.id,selectors:r,classes:n}))}if("object"==_typeof(e)){var a,s=e.name,l=e.label,c=void 0===l?s:l,u="checkout_attributes_".concat(s),p="checkout[attributes][".concat(s,"]"),d=document.createElement("div");d.classList.add(n.field);var h=document.createElement("div");h.classList.add(n.wrapper);var f=document.createElement("label");return(a=f.classList).add.apply(a,_toConsumableArray(n.label)),f.innerText=c,f.htmlFor=u,h.appendChild(f),d.appendChild(h),Object.setPrototypeOf(d,t.prototype),_possibleConstructorReturn(void 0,Object.assign(d,{fieldName:p,fieldId:u,selectors:r,classes:n}))}return _possibleConstructorReturn(void 0)}return _createClass(t,[{key:"created",value:function(){var e=new CustomEvent("checkout:field:created",{detail:this});document.dispatchEvent(e)}},{key:"addField",value:function(e){throw new NotImplementedError}},{key:"showError",value:function(e){var t;if(this.removeError(),(t=this.classList).add.apply(t,_toConsumableArray(this.classes.fieldError)),e&&e.length>0){var r,n=document.createElement("p");(r=n.classList).add.apply(r,_toConsumableArray(this.classes.fieldErrorMessage)),n.innerHTML=e,this.appendChild(n)}}},{key:"removeError",value:function(){var e;(e=this.classList).remove.apply(e,_toConsumableArray(this.classes.fieldError)),this.querySelectorAll(this.selectors.errorMessage).forEach((function(e){e.remove()}))}},{key:"remove",value:function(){var e=new CustomEvent("checkout:field:removed",{detail:this});document.dispatchEvent(e),_get(_getPrototypeOf(t.prototype),"remove",this).call(this)}},{key:"value",get:function(){return this.querySelector(this.selectors.input).value},set:function(e){this.querySelector(this.selectors.input).value=e}},{key:"insertAfter",value:function(e){if(!(e&&e instanceof t))throw TypeError("Object trying to add is not a Field element");this.insertAdjacentElement("afterend",e)}},{key:"insertBefore",value:function(e){if(!(e&&e instanceof t))throw TypeError("Object trying to add is not a Field element");this.insertAdjacentElement("beforebegin",e)}}]),t}(),Tooltip=function(e){_inherits(t,_wrapNativeSuper(HTMLDivElement));_createSuper(t);function t(e,r){var n,i,o,a,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#question";_classCallCheck(this,t);var c={wrapper:["field__icon","has-tooltip"],tooltip:["tooltip"],svgWrapper:["field__icon-svg"],svgIcon:["icon-svg","icon-svg--color-adaptive-lighter","icon-svg--size-16","icon-svg--block"]},u=document.createElement("div");u.setAttribute("role","tooltip"),(n=u.classList).add.apply(n,_toConsumableArray(c.wrapper));var p=document.createElement("span");p.id="tooltip-for-".concat(r),(i=p.classList).add.apply(i,_toConsumableArray(c.tooltip)),p.innerText=e;var d=document.createElement("div");(o=d.classList).add.apply(o,_toConsumableArray(c.svgWrapper));var h=document.createElementNS("http://www.w3.org/2000/svg","svg");(a=h.classList).add.apply(a,_toConsumableArray(c.svgIcon)),h.setAttribute("role","presentation"),h.focusable="false";var f=document.createElementNS("http://www.w3.org/2000/svg","use");return f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l),f.setAttributeNS("http://www.w3.org/1999/xlink","href",l),h.appendChild(f),d.appendChild(h),u.appendChild(p),u.appendChild(d),_possibleConstructorReturn(s,u)}return _createClass(t)}(),TextField=function(e){_inherits(r,Field);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),"object"==_typeof(e)&&n.addField(e),n.created(),n}return _createClass(r,[{key:"addField",value:function(e){var t,r=document.createElement("input");(t=r.classList).add.apply(t,_toConsumableArray(this.classes.fieldInput)),r.placeholder=e.placeholder?e.placeholder:"",r.size=e.size?e.size:30,r.type=e.type?e.type:"text",r.value=e.defaultValue?e.defaultValue:"",r.name=this.fieldName,r.id=this.fieldId,this.querySelector(this.selectors.wrapper).appendChild(r),"string"==typeof e.tooltip&&this.addTooltip(e.tooltip)}},{key:"addTooltip",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#question";this.removeTooltip();var r=this.querySelector(this.selectors.wrapper);r.classList.add("field__input-wrapper--icon-right");var n=new Tooltip(e,this.fieldId,t);r.appendChild(n)}},{key:"removeTooltip",value:function(){var e=this.querySelector(this.selectors.wrapper),t=e.querySelectorAll(".field__icon");e.classList.remove("field__input-wrapper--icon-right"),t.forEach((function(e){e.remove()}))}}]),r}(),CheckboxField=function(e){_inherits(r,Field);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);var i={input:'input[type="checkbox"]',wrapper:".checkbox-wrapper"},o={label:["checkbox__label"],fieldInputWrapper:["checkbox__input"],fieldInput:["input-checkbox"],wrapper:["checkbox-wrapper"]};if("object"==_typeof(e)){var a,s;e.type="checkbox";var l=(n=t.call(this,e)).querySelector(n.selectors.wrapper);(a=l.classList).remove.apply(a,_toConsumableArray(l.classList)),(s=l.classList).add.apply(s,_toConsumableArray(o.wrapper)),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),Object.assign(n.classes,o),Object.assign(n.selectors,i);var c="boolean"==typeof e.checked&&e.checked;n.addField(c)}else n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),Object.assign(n.classes,o),Object.assign(n.selectors,i);return n.created(),_possibleConstructorReturn(n)}return _createClass(r,[{key:"addField",value:function(e){var t,r,n,i,o=this.querySelector(this.selectors.wrapper),a=o.querySelector("label");(t=a.classList).remove.apply(t,_toConsumableArray(a.classList)),(r=a.classList).add.apply(r,_toConsumableArray(this.classes.label));var s=document.createElement("div");(n=s.classList).add.apply(n,_toConsumableArray(this.classes.fieldInputWrapper));var l=document.createElement("input");(i=l.classList).add.apply(i,_toConsumableArray(this.classes.fieldInput)),l.type="checkbox",l.checked=e,l.name=this.fieldName,l.id=this.fieldId,s.appendChild(l),o.insertBefore(s,a)}},{key:"checked",get:function(){return this.querySelector(this.selectors.input).checked},set:function(e){this.querySelector(this.selectors.input).checked=e}}]),r}(),DropdownField=function(e){_inherits(r,Field);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);return n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),Object.assign(n.classes,{field:["field","field--show-floating-label"],fieldInput:["field__input","field__input--select"],fieldInputWrapper:["field__input-wrapper","field__input-wrapper--select"],arrow:["field__caret","shown-if-js"],svgIcon:["icon-svg","icon-svg--color-adaptive-lighter","icon-svg--size-10","field__caret-svg"]}),"object"==_typeof(e)&&n.addField(e),n.created(),n}return _createClass(r,[{key:"addField",value:function(e){var t,r,n,i,o;if(!e.options)throw new ReferenceError("No options defined for DropdownField");(t=this.classList).add.apply(t,_toConsumableArray(this.classes.field));var a=this.querySelector(this.selectors.wrapper);(r=a.classList).add.apply(r,_toConsumableArray(this.classes.fieldInputWrapper));var s=document.createElement("select");if((n=s.classList).add.apply(n,_toConsumableArray(this.classes.fieldInput)),s.placeholder=e.placeholder?e.placeholder:"",s.name=this.fieldName,s.id=this.fieldId,e.defaultValue){var l=document.createElement("option");l.disabled=!0,l.selected=!0,l.innerText=e.defaultValue,s.add(l),s.placeholder=e.placeholder?e.placeholder:e.defaultValue}e.options.forEach((function(e){var t=document.createElement("option");t.innerText=e.text,t.value=e.value,s.add(t)}));var c=document.createElement("div");(i=c.classList).add.apply(i,_toConsumableArray(this.classes.arrow));var u=document.createElementNS("http://www.w3.org/2000/svg","svg");(o=u.classList).add.apply(o,_toConsumableArray(this.classes.svgIcon)),u.setAttribute("role","presentation"),u.focusable="false";var p=document.createElementNS("http://www.w3.org/2000/svg","use");p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#caret-down"),p.setAttributeNS("http://www.w3.org/1999/xlink","href","#caret-down"),u.appendChild(p),c.appendChild(u),a.appendChild(s),a.appendChild(c)}}]),r}(),FieldFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createFieldByElement",value:function(e){switch(e.type){case"text":case"email":case"tel":return new TextField(e.id);case"checkbox":return new CheckboxField(e.id);case"select-one":return new DropdownField(e.id);case"hidden":return null;default:try{return new Field(e.id)}catch(e){if(e instanceof NotValidFieldException)return null;throw e}}}}]),e}(),Checkout=function(){function e(){_classCallCheck(this,e),this.Steps={INFORMATION:"contact_information",SHIPPING:"shipping_method",PAYMENT:"payment_method",PROCESSING:"processing",THANKYOU:"thank_you",ORDERSTATUS:"order_status",STOCK_PROBLEMS:"stock_problems"},this.selectors={inputs:"input[id], select[id]",selectionMethods:".section--{TYPE}-method .radio-wrapper",fields:'[id^="checkout_"]',stockProblem:{list:".stock-problem-table .product__description",name:".product__description__name",description:".product__description__variant"}},document.addEventListener("page:load",this._onLoad.bind(this),!1),document.addEventListener("page:change",this._onLoad.bind(this),!1),document.addEventListener("checkout:field:created",this._fieldCreated.bind(this),!1),document.addEventListener("checkout:field:removed",this._fieldRemoved.bind(this),!1),this.lastStep=this._getLastStep(),this.currentStep=this._getCurrentStep(),this.fields=[],this.fields=this._getFields()}return _createClass(e,[{key:"_getFields",value:function(){var e=[],t=document.querySelectorAll(this.selectors.inputs),r=new FieldFactory;return t.forEach((function(t){var n=r.createFieldByElement(t);null!=n&&(e[t.id]=n)})),e}},{key:"_getLastStep",value:function(){var e=sessionStorage.getItem("step");null==e&&document.referrer&&(e=new URL(document.referrer).pathname);return e}},{key:"_getCurrentStep",value:function(){var e=Shopify.Checkout.step;return"stock_problems"==Shopify.Checkout.page&&(e=this.Steps.STOCK_PROBLEMS),void 0!==Shopify.Checkout.OrderStatus&&(e="thank_you"==Shopify.Checkout.page?this.Steps.THANKYOU:this.Steps.ORDERSTATUS),sessionStorage.setItem("step",e),e}},{key:"_triggerEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new CustomEvent("checkout:".concat(e),{detail:t});document.dispatchEvent(r)}},{key:"_getSelectionMethods",value:function(e){var t=document.querySelectorAll(this.selectors.selectionMethods.replace("{TYPE}",e)),r=[];return t.forEach((function(t){try{"shipping"==e?r.push(new ShippingMethod(t)):"payment"==e&&r.push(new PaymentMethod(t))}catch(e){if(!(e instanceof NotValidFieldException))throw e}})),r}},{key:"_getStockProblemList",value:function(){var e,t=[],r=_createForOfIteratorHelper(document.querySelectorAll(this.selectors.stockProblem.list));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=n.querySelector(this.selectors.stockProblem.name).innerText,o=n.querySelector(this.selectors.stockProblem.description).innerText;t.push({name:i,variant:o})}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"_onLoad",value:function(e){try{switch(this._triggerEvent("load"),this.currentStep){case this.Steps.INFORMATION:this._triggerEvent("load:information");break;case this.Steps.SHIPPING:var t=this._getSelectionMethods("shipping");this._triggerEvent("load:shipping",{shippingMethods:t});break;case this.Steps.PAYMENT:var r=this._getSelectionMethods("payment");this._triggerEvent("load:payment",{paymentMethods:r});break;case this.Steps.PROCESSING:this._triggerEvent("load:processing");break;case this.Steps.THANKYOU:this._triggerEvent("load:thankyou");break;case this.Steps.ORDERSTATUS:this._triggerEvent("load:orderstatus");break;case this.Steps.STOCK_PROBLEMS:var n=this._getStockProblemList();this._triggerEvent("load:stockproblems",{stockProblemList:n})}}catch(t){this._triggerEvent("error",{step:this.currentStep,event:e,error:t})}}},{key:"_fieldCreated",value:function(e){var t=e.detail,r=t.querySelector(this.selectors.fields),n=Object.prototype.hasOwnProperty.call(this.fields,r.id);this.fields&&!n&&(this.fields[r.id]=t)}},{key:"_fieldRemoved",value:function(e){var t=e.detail.querySelector(this.selectors.fields),r=Object.prototype.hasOwnProperty.call(this.fields,t.id);this.fields&&r&&delete this.fields[t.id]}},{key:"on",value:function(e,t){document.addEventListener("checkout:".concat(e),t,!1)}}]),e}(),_default=Checkout;exports.default=_default;